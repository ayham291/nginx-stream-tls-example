# Setting up NGINX as entry point

This is an example of how to setup NGINX as an entry point to the system.

Testing this monster:

```bash
docker-compose up nginx-proxy wetty-ssh
```

## Table of Contents

- [Features](#features)
- [Tech](#tech)
  - [WETTY - Web TTY](#wetty---web-tty)
  - [NGINX - TCP Proxy](#nginx---tcp-proxy)
  - [Adding client certificate to the browser](#adding-client-certificate-to-the-browser)
  - [Generating CA and certificates](#generating-ca-and-certificates)
    - [NGINX configuration](#nginx-configuration)

## Features

- Access to the system from a web browser with ssh and client certificate.
- Encrypted access to the system.
- Separation between IT and OT.

## Tech

This example uses a number of open source projects to work properly:

- [WETTY] - Web TTY
- [NGINX](https://www.nginx.com/) - Reverse proxy
- [pki](https://github.com/ayham291/pki) - A simple PKI tool.

### WETTY - Web TTY

Allows access to a host with ssh directly from the browser.

### NGINX - TCP Proxy

NGINX is used as a TCP proxy to forward the traffic to the correct host. Also
it is used to terminate the TLS connection and verify the client certificate.

### Adding client certificate to the browser

Using your certificate generated by the CA, you can add it to the browser and
access the server without the need to enter the password.

The key and the certificate need to be converted to PKCS12 format to be added
to the browsers keystore.

```bash
openssl pkcs12 -export -out client.pfx -inkey client.key -in client.crt
```

Additionally you will need to add the CA certificate and all intermediate
certificates to the browsers keystore.

### Generating CA and certificates

Using [pki](https://github.com/ayham291/pki) you can generate the CA and
certificates.

Here is an example of how to generate the CA and intermediate certificates.

```bash
myPKI -t root -d <DAYS>
myPKI -t network -d <DAYS>
myPKI -t component -d <DAYS>
```

Here is an example of how to generate the server certificate.

```bash
myPKI -s server -d <DAYS> -n <HOSTNAME|FQDN>
myPKI -s client -d <DAYS> -n <NMAE>
```

#### NGINX configuration

In order to try it out you will need add the certificate fingerprint 
to the NGINX configuration.

```bash
openssl x509 -in client.crt -noout -sha256 -fingerprint
```
